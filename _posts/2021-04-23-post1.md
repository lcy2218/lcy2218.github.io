---
layout: post
title:  DNS协议
date: 2021-04-23 23:05 +0900
category: routing-theory
---

## 0x0 DNS封装和报文格式

![](/images/20210423-1.png)
- 事务 ID：DNS 报文的 ID 标识。对于请求报文和其对应的应答报文，该字段的值是相同的。通过它可以区分 DNS 应答报文是对哪个请求进行响应的。
- 标志：DNS 报文中的标志字段。
    - QR（Response）：查询请求/响应的标志信息。查询请求时，值为 0；响应时，值为 1。
    - Opcode：操作码。其中，0 表示标准查询；1 表示反向查询；2 表示服务器状态请求。
    - AA（Authoritative）：授权应答，该字段在响应报文中有效。值为 1 时，表示名称服务器是权威服务器；值为 0 时，表示不是权威服务器。
    - TC（Truncated）：表示是否被截断。值为 1 时，表示响应已超过 512 字节并已被截断，只返回前 512 个字节。
    - RD（Recursion Desired）：期望递归。如果该位为 0，且被请求的域名服务器没有一个授权回答，它将返回一个能解答该查询的其他域名服务器列表。这种方式被称为迭代查询。
    - RA（Recursion Available）：支持递归。该字段只出现在响应报文中。当值为 1 时，表示服务器支持递归查询。
    - Z：保留字段，在所有的请求和应答报文中，它的值必须为 0。
    - rcode（Reply code）：返回码字段，表示响应的差错状态。
        - 当值为 0 时，表示没有错误；
        - 当值为 1 时，表示报文格式错误（Format error），服务器不能理解请求的报文；
        - 当值为 2 时，表示域名服务器失败（Server failure），因为服务器的原因导致没办法处理这个请求；
        - 当值为 3 时，表示名字错误（Name Error），只有对授权域名解析服务器有意义，指出解析的域名不存在；
        - 当值为 4 时，表示查询类型不支持（Not Implemented），即域名服务器不支持查询类型；
        - 当值为 5 时，表示拒绝（Refused），一般是服务器由于设置的策略拒绝给出应答，如服务器不希望对某些请求者给出应答。
- 问题计数：DNS 查询请求的数目。
- 回答资源记录数：DNS 响应的数目。
- 权威名称服务器计数：权威名称服务器的数目。
- 附加资源记录数：额外的记录数目（权威名称服务器对应 IP 地址的数目）。